# GameLobbyApp

P2P通信を行うにはクライアント同士が通信相手のIPとポート番号(以下この対をIPEndPoint)を把握している必要があります。

このレポジトリはゲームクライアント同士でIPを交換するためのロビーサーバーを提供します。
これ自体にゲームロジックの同期機能はありません。

このサーバーの機能は
- 部屋作成機能
- 部屋参加機能

を持ちます。

クライアントは
1. このサーバーの部屋に参加し
2. 同じ部屋に別クライアントが接続するのを待ち
3. ゲーム開始のタイミングで自身のIPEndPointを登録し
4. 他のクライアントのIPEndpointが揃ったタイミングでIPEndPointをサーバーから取得する、

という流れを想定しています。

# IPEndPoint登録とNAT越え

クライアントがサーバーに登録する自身のIPEndPointを取得する機能はこのサーバーに含まれません。

IPアドレスにはプライベートとグローバルIPアドレスが存在し、プライベートIPアドレスはルーターを経由する際にNAPTと呼ばれる変換表によって1つのグローバルIPアドレスに変換されます。(e.g. 192.168.0.1:5000 -> xxx.xxx.xxx.xxx:51212)

グローバルIPアドレスには以下のような特徴があります
- IPアドレス、ポート番号はルーターによって動的に割り振られるため、事前に知ることはできません
- 一定の間隔で通信がない場合、動的に解放されます
  - なのでクライアントはサーバーの準備が整ってから通信に用いるポートを決める必要があります
- グローバルIPアドレス、ポート番号が別クライアントから見た際の入口になりますが、本人からは見えません
  - なのでSTUNなどを用いて他のサーバーから自身のグローバルIPアドレスを取得してロビーに登録する必要があります
